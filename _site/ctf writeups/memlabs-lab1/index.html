<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>MemLabs - Lab1 - Zakariae el bouzarazi</title>
<meta name="description" content="MemLabs is an educational, introductory set of CTF-styled challenges which is aimed to encourage students, security researchers and CTF  players to get started with the field of Memory Forensics Each challenge has a description along with a memory dump file. We are supposed to get all the flags using memory forensics tools (mainly volatility)… ">


  <meta name="author" content="Zakariae El bouzarazi">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Zakariae el bouzarazi">
<meta property="og:title" content="MemLabs - Lab1">
<meta property="og:url" content="https://github.com/elbouzarazi/elbouzarazi.github.io/pages/elbouzarazi/ctf%20writeups/memlabs-lab1/">


  <meta property="og:description" content="MemLabs is an educational, introductory set of CTF-styled challenges which is aimed to encourage students, security researchers and CTF  players to get started with the field of Memory Forensics Each challenge has a description along with a memory dump file. We are supposed to get all the flags using memory forensics tools (mainly volatility)… ">



  <meta property="og:image" content="https://github.com/elbouzarazi/elbouzarazi.github.io/pages/elbouzarazi/assets/images/ctf-writeups/memlabs/logo.png">





  <meta property="article:published_time" content="2020-05-15T00:00:00+01:00">





  

  


<link rel="canonical" href="https://github.com/elbouzarazi/elbouzarazi.github.io/pages/elbouzarazi/ctf%20writeups/memlabs-lab1/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "zakariae Elbouzarazi",
      "url": "https://github.com/elbouzarazi/elbouzarazi.github.io/pages/elbouzarazi/"
    
  }
</script>


  <meta name="google-site-verification" content="J3MnMF94zaZhTUoNtUiRt9cKsr7hiMyTxEdAvQ3GfmY" />





<!-- end _includes/seo.html -->


<link href="/pages/elbouzarazi/feed.xml" type="application/atom+xml" rel="alternate" title="Zakariae el bouzarazi Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/pages/elbouzarazi/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<!-- favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/site_data/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/site_data/favicon-16x16.png">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/pages/elbouzarazi/"><img src="/pages/elbouzarazi/assets/images/site_data/logo.png" alt=""></a>
        
        <a class="site-title" href="/pages/elbouzarazi/">
          Zakariae el bouzarazi
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/pages/elbouzarazi/categories/#malware-analysis">Malware Analysis</a>
            </li><li class="masthead__menu-item">
              <a href="/pages/elbouzarazi/categories/#binary-exploitation">Binary Exploitation</a>
            </li><li class="masthead__menu-item">
              <a href="/pages/elbouzarazi/categories/#ctf-writeups">CTF Writeups</a>
            </li><li class="masthead__menu-item">
              <a href="/pages/elbouzarazi/categories/#tutorials">Tutorials</a>
            </li><li class="masthead__menu-item">
              <a href="/pages/elbouzarazi/categories">All Categories</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/pages/elbouzarazi/assets/images/site_data/avatar.jpg" alt="Zakariae El bouzarazi" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Zakariae El bouzarazi</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Malware Analysis &amp; Reverse Engineering Adventures.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="zekuelbouzrazi@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://twitter.com/_n1ghtw0lf" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/zakariae-elbouzarazi-34126b293/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/elbouzarazi" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="MemLabs - Lab1">
    <meta itemprop="description" content="MemLabs is an educational, introductory set of CTF-styled challenges which is aimed to encourage students, security researchers and CTF  players to get started with the field of Memory Forensics.">
    <meta itemprop="datePublished" content="2020-05-15T00:00:00+01:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">MemLabs - Lab1
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  4 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>MemLabs is an educational, introductory set of CTF-styled challenges which is aimed to encourage students, security researchers and CTF  players to get started with the field of <strong>Memory Forensics</strong>.</p>

<p>Each challenge has a description along with a memory dump file. We are supposed to get all the flags using memory forensics tools (mainly volatility).</p>

<p>You can read more about MemLabs here: <a href="https://github.com/stuxnet999/MemLabs">MebLabs</a></p>

<blockquote>
  <h2 id="challenge-description"><strong>Challenge Description</strong></h2>

  <p>My sister’s computer crashed. We were very fortunate to recover this  memory dump. Your job is get all her important files from the system.  From what we remember, we suddenly saw a black window pop up with some  thing being executed. When the crash happened, she was trying to draw  something. Thats all we remember from the time of crash.</p>

  <p><strong>Note</strong>: This challenge is composed of 3 flags.</p>

  <p><strong>Challenge file</strong>: <a href="https://mega.nz/#!6l4BhKIb!l8ATZoliB_ULlvlkESwkPiXAETJEF7p91Gf9CWuQI70">MemLabs_Lab1</a></p>
</blockquote>

<p>The first thing to do with a memory dump file is to identify the operating system, for that we use <code class="language-plaintext highlighter-rouge">imageinfo</code> plugin.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ volatility -f MemoryDump_Lab1.raw imageinfo
</code></pre></div></div>

<p><a href="/assets/images/ctf-writeups/memlabs/lab1/1.png"><img src="/assets/images/ctf-writeups/memlabs/lab1/1.png" alt="1" /></a></p>

<p>We can see volatility has a lot of suggestions for the profile, usually the first one is sufficient.</p>

<p>Next we check the running processes using <code class="language-plaintext highlighter-rouge">pslist</code> plugin.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ volatility -f MemoryDump_Lab1.raw --profile Win7SP1x64 pslist
</code></pre></div></div>

<p><a href="/assets/images/ctf-writeups/memlabs/lab1/2.png"><img src="/assets/images/ctf-writeups/memlabs/lab1/2.png" alt="2" /></a></p>

<p>There are 3 interesting processes here, let’s start with <code class="language-plaintext highlighter-rouge">cmd.exe</code>. This process indicates that commands were executed on the system.</p>

<p>We can use <code class="language-plaintext highlighter-rouge">consoles</code> plugin to see the output</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ volatility -f MemoryDump_Lab1.raw --profile Win7SP1x64 consoles
</code></pre></div></div>

<p><a href="/assets/images/ctf-writeups/memlabs/lab1/3.png"><img src="/assets/images/ctf-writeups/memlabs/lab1/3.png" alt="3" /></a></p>

<p>If you look closely to the output of the command <code class="language-plaintext highlighter-rouge">St4G3$1</code>, you can spot some <code class="language-plaintext highlighter-rouge">Base64</code> text. If we decode it we get the flag of stage 1.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ echo ZmxhZ3t0aDFzXzFzX3RoM18xc3Rfc3Q0ZzMhIX0= | base64 -d
flag{th1s_1s_th3_1st_st4g3!!}
</code></pre></div></div>

<blockquote>
  <h4 id="flag-1-flagth1s_1s_th3_1st_st4g3">Flag 1: flag{th1s_1s_th3_1st_st4g3!!}</h4>
</blockquote>

<p>Next we will focus on the second interesting process, which is <code class="language-plaintext highlighter-rouge">mspaint.exe</code>. The PID of this process is 2424.</p>

<p>If you go back to the challenge description, we can see that the user was drawing something (using mspaint of course).</p>

<p>After some googling, I found that we can dump the mspaint’s process memory to extract the image back.</p>

<p>So let’s use <code class="language-plaintext highlighter-rouge">memdump</code> plugin to extract some data.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ volatility -f MemoryDump_Lab1.raw --profile Win7SP1x64 memdump -p 2424 -D lab1_output/
</code></pre></div></div>

<p>The output is written to <code class="language-plaintext highlighter-rouge">2424.dmp</code>, we need to rename it to <code class="language-plaintext highlighter-rouge">2424.data</code> to be able to open it in Gimp.</p>

<p>After playing a bit with the width and offset. I got an image which is somewhat flipped. I rotated it 180 degrees then flipped it horizontally and Voila!, I got the flag.</p>

<table>
  <tbody>
    <tr>
      <td><a href="/assets/images/ctf-writeups/memlabs/lab1/4.png"><img src="/assets/images/ctf-writeups/memlabs/lab1/4.png" alt="4" /></a></td>
      <td><a href="/assets/images/ctf-writeups/memlabs/lab1/5.png"><img src="/assets/images/ctf-writeups/memlabs/lab1/5.png" alt="5" /></a></td>
    </tr>
  </tbody>
</table>

<blockquote>
  <h4 id="flag-2-flagg00d_boy_good_girl">Flag 2: flag{G00d_Boy_good_girL}</h4>
</blockquote>

<p>The third interesting process is <code class="language-plaintext highlighter-rouge">WinRAR.exe</code> with PID 1512, we can use <code class="language-plaintext highlighter-rouge">cmdline</code> plugin to see the associated command line.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ volatility -f MemoryDump_Lab1.raw --profile Win7SP1x64 cmdline | grep WinRAR
Volatility Foundation Volatility Framework 2.6.1
WinRAR.exe pid:   1512
Command line : "C:\Program Files\WinRAR\WinRAR.exe" "C:\Users\Alissa Simpson\Documents\Important.rar"
</code></pre></div></div>

<p>Great, we got the name of the rar file which is <code class="language-plaintext highlighter-rouge">Important.rar</code> (looks important).</p>

<p>Next we can use <code class="language-plaintext highlighter-rouge">filescan</code> plugin to get the psychical offset of that file in memory.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ volatility -f MemoryDump_Lab1.raw --profile Win7SP1x64 filescan | grep Important.rar
Volatility Foundation Volatility Framework 2.6.1
0x000000003fa3ebc0      1      0 R--r-- \Device\HarddiskVolume2\Users\Alissa Simpson\Documents\Important.rar
0x000000003fac3bc0      1      0 R--r-- \Device\HarddiskVolume2\Users\Alissa Simpson\Documents\Important.rar
0x000000003fb48bc0      1      0 R--r-- \Device\HarddiskVolume2\Users\Alissa Simpson\Documents\Important.rar
</code></pre></div></div>

<p>We can pick any of these offsets, To dump the file we can use <code class="language-plaintext highlighter-rouge">dumpfiles</code> plugin.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ volatility -f MemoryDump_Lab1.raw --profile Win7SP1x64 dumpfiles -Q 0x000000003fa3ebc0 -D lab1_output/
Volatility Foundation Volatility Framework 2.6.1
DataSectionObject 0x3fa3ebc0   None   \Device\HarddiskVolume2\Users\Alissa Simpson\Documents\Important.rar
</code></pre></div></div>

<p>The file is dumped under the name <code class="language-plaintext highlighter-rouge">file.None.0xfffffa8001034450.dat</code>, let’s rename and unrar it.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mv file.None.0xfffffa8001034450.dat Important.rar
$ unrar e Important.rar 

UNRAR 5.61 beta 1 freeware      Copyright (c) 1993-2018 Alexander Roshal

Extracting from Important.rar

Password is NTLM hash(in uppercase) of Alissa's account passwd.

Enter password (will not be echoed) for flag3.png: 
</code></pre></div></div>

<p>The file is password protected, but we can see a comment that says the password is the NTLM hash of Alissa’s account passwd.</p>

<p>To get the password hash, we can use <code class="language-plaintext highlighter-rouge">hashdump</code> plugin.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ volatility -f MemoryDump_Lab1.raw --profile Win7SP1x64 hashdump
Volatility Foundation Volatility Framework 2.6.1
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
SmartNet:1001:aad3b435b51404eeaad3b435b51404ee:4943abb39473a6f32c11301f4987e7e0:::
HomeGroupUser$:1002:aad3b435b51404eeaad3b435b51404ee:f0fc3d257814e08fea06e63c5762ebd5:::
Alissa Simpson:1003:aad3b435b51404eeaad3b435b51404ee:f4ff64c8baac57d22f22edc681055ba6:::
</code></pre></div></div>

<blockquote>
  <p>Windows stores two hashes with each password, delimited by colons. The first one is an extremely insecure, obsolete hash using the LANMAN algorithm. Windows operating systems since Vista no longer use LANMAN hashes, so they are filled with a dummy value starting with “aad”.</p>

  <p>The second hash is the newer NTLM hash, which is much better than LANMAN hashes, but still extremely insecure and much more easily cracked than Linux or Mac OS X hashes.</p>
</blockquote>

<p>The desired NTLM hash is <code class="language-plaintext highlighter-rouge">f4ff64c8baac57d22f22edc681055ba6</code> (remember it must be in uppercase).</p>

<p>After decompressing the file, we get an image with the flag.</p>

<p><a href="/assets/images/ctf-writeups/memlabs/lab1/6.png"><img src="/assets/images/ctf-writeups/memlabs/lab1/6.png" alt="6" /></a></p>

<blockquote>
  <h4 id="flag-3-flagw3ll_3rd_stage_was_easy">Flag 3: flag{w3ll_3rd_stage_was_easy}</h4>
</blockquote>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/pages/elbouzarazi/categories/#ctf-writeups" class="page__taxonomy-item" rel="tag">CTF Writeups</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-05-15T00:00:00+01:00">May 15, 2020</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/pages/elbouzarazi/malware%20analysis/ryuk-ransomware/" class="pagination--pager" title="Deep Analysis of Ryuk Ransomware
">Previous</a>
    
    
      <a href="/pages/elbouzarazi/ctf%20writeups/memlabs-lab2/" class="pagination--pager" title="MemLabs - Lab2
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/pages/elbouzarazi/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 zakariae Elbouzarazi. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/pages/elbouzarazi/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/pages/elbouzarazi/assets/js/lunr/lunr.min.js"></script>
<script src="/pages/elbouzarazi/assets/js/lunr/lunr-store.js"></script>
<script src="/pages/elbouzarazi/assets/js/lunr/lunr-en.js"></script>




  <script>
  window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
  ga('create','UA-165194559-1','auto');
  ga('set', 'anonymizeIp', false);
  ga('send','pageview')
</script>
<script src="https://www.google-analytics.com/analytics.js" async></script>









  </body>
</html>
